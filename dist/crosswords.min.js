var CrosswordsJS=function(e,t){"use strict";function r(e,t){var r=new RegExp("(?:^|\\s)"+t+"(?!\\S)","g");e.className=e.className.replace(r,"")}function l(e,t){e.className+=" "+t}function s(e,t){for(var r=new Array(e),l=0;t>l;l++){r[l]=new Array(t);for(var s=0;t>s;s++)r[l][s]={}}return r}function n(e,t){if(this.width=t.width,this.height=t.height,this.acrossClues=[],this.downClues=[],this.cells=s(this.width,this.height),void 0===this.width||null===this.width||this.width<0||void 0===this.height||null===this.height||this.height<0)throw new Error("The crossword bounds are invalid.");for(var r=t.acrossClues.concat(t.downClues),l=0;l<r.length;l++){var n=r[l],o=l<t.acrossClues.length,c={number:n.number,code:n.number+(o?"a":"d"),answer:n.answer,x:n.x-1,y:n.y-1,across:o,length:[],totalLength:0,clue:n.clue,cells:[]};if(this[o?"acrossClues":"downClues"].push(c),c.x<0||c.x>=this.width||c.y<0||c.y>=this.height)throw new Error("Clue "+c.code+" doesn't start in the bounds.");for(var a=0;a<n.length.length;a++)c.length.push(n.length[a]),c.totalLength+=n.length[a];if(o){if(c.x+c.totalLength>this.width)throw new Error("Clue "+c.code+" exceeds horizontal bounds.")}else if(c.y+c.totalLength>this.height)throw new Error("Clue "+c.code+" exceeds vertical bounds.");for(var i=c.x,u=c.y,d=0;d<c.totalLength;d++){var h=this.cells[i][u];if(h.light=!0,h[o?"acrossClue":"downClue"]=c,h[o?"acrossClueLetterIndex":"downClueLetterIndex"]=d,c.cells.push(h),c.answer){if(void 0!==h.answer&&h.answer!==c.answer[d])throw new Error("Clue "+c.code+" answer at ("+(i+1)+", "+(u+1)+") is not coherent with previous clue ("+h.acrossClue.code+") answer.");h.answer=c.answer[d]}if(0===d){if(h.clueLabel&&h.clueLabel!==c.number)throw new Error("Clue "+c.code+" has a label which is inconsistent with another clue ("+h.acrossClue.code+").");h.clueLabel=c.number}o?i++:u++}}this.crosswordElement=this._createDOM(e)}function o(e){if(null===e||void 0===e)throw new Error("An options parameter must be passed to 'crossword'.");if(null===e.element||void 0===e.element)throw new Error("The crossword must be initialised with a valid DOM element.");if(null===e.crosswordDefinition||void 0===e.crosswordDefinition)throw new Error("The crossword must be initialised with a crossword definition.");return new n(e.element,e.crosswordDefinition)}var c=[],a=function(e){for(var t=0;t<c.length;t++)if(c[t].cellElement===e)return c[t];return null};return n.prototype.selectClue=function(e){this.currentClue=e,this._updateDOM(),this.currentClue.cells[0].cellElement.focus(),this._stateChange("clueSelected")},n.prototype._stateChange=function(e,t){var r=this.onStateChanged;r&&r({message:e,data:t})},n.prototype._createDOM=function(e){var r=t.createElement("div");r.className="crossword";for(var l=0;l<this.height;l++){var s=t.createElement("div");s.className="cwrow",r.appendChild(s);for(var n=0;n<this.width;n++){var o=this.cells[n][l],a=this._createCellDOM(o);s.appendChild(a),c.push({cellElement:a,crossword:this,cell:o})}}e.appendChild(r)},n.prototype._createCellDOM=function(e){var r=t.createElement("div");if(r.className="cwcell",e.cellElement=r,r.className+=e.light?" light":" dark",!e.light)return r;var l=t.createElement("input");if(l.maxLength=1,r.appendChild(l),e.clueLabel){var s=t.createElement("div");s.className="cwcluelabel",s.innerHTML=e.clueLabel,r.appendChild(s)}return l.addEventListener("focus",function(e){var t=e.target.parentNode,r=a(t),l=r.crossword,s=r.cell.acrossClue,n=r.cell.downClue;(!l.currentClue||l.currentClue!==s&&l.currentClue!==n)&&(l.currentClue=s&&!n||!s&&n?s||n:0===r.cell.downClueLetterIndex&&0!==r.cell.acrossClueLetterIndex?n:s,l._updateDOM(),l._stateChange("clueSelected"))}),r.addEventListener("keydown",function(e){if(8===e.keyCode){e.preventDefault(),e.target.value="";var t=e.target.parentNode,r=a(t),l=r.cell,s=r.crossword.currentClue,n=l.acrossClue===s?l.acrossClueLetterIndex:l.downClueLetterIndex,o=n-1;o>=0&&s.cells[o].cellElement.querySelector("input").focus()}else if(9===e.keyCode){e.preventDefault();for(var t=e.target.parentNode,r=a(t),s=r.crossword.currentClue,c=r.crossword,i=s.across?c.acrossClues:c.downClues,u=0;u<i.length;u++)if(s===i[u]){var d=null;d=e.shiftKey?u>0?i[u-1]:s.across?c.downClues[c.downClues.length-1]:c.acrossClues[c.acrossClues.length-1]:u<i.length-1?i[u+1]:s.across?c.downClues[0]:c.acrossClues[0],c.currentClue=d,c._updateDOM(),d.cells[0].cellElement.querySelector("input").focus({internal:!0});break}}else if(13===e.keyCode){e.preventDefault();var t=e.target.parentNode,r=a(t),l=r.cell,c=r.crossword;l.acrossClue&&l.downClue&&(c.currentClue=l.acrossClue===c.currentClue?l.downClue:l.acrossClue,c._updateDOM())}}),r.addEventListener("keypress",function(e){32===e.keyCode&&e.preventDefault(),e.target.value="";var t=e.target.parentNode,r=a(t),l=r.cell,s=r.crossword.currentClue,n=l.acrossClue===s?l.acrossClueLetterIndex:l.downClueLetterIndex,o=n+1;o<s.cells.length&&s.cells[o].cellElement.querySelector("input").focus()}),r.addEventListener("keyup",function(e){switch(e.keyCode){case 37:var t=e.target.parentNode,r=a(t),l=r.cell,s=l.x,n=l.y;l.x>0&&r.crossword.cells[s-1][n].light===!0&&r.crossword.cells[s-1][n].cellElement.querySelector("input").focus();break;case 38:var t=e.target.parentNode,r=a(t),l=r.cell,s=l.x,n=l.y;l.y>0&&r.crossword.cells[s][n-1].light===!0&&r.crossword.cells[s][n-1].cellElement.querySelector("input").focus();break;case 39:var t=e.target.parentNode,r=a(t),l=r.cell,o=r.crossword.width,s=l.x,n=l.y;l.x+1<o&&r.crossword.cells[s+1][n].light===!0&&r.crossword.cells[s+1][n].cellElement.querySelector("input").focus();break;case 40:var t=e.target.parentNode,r=a(t),l=r.cell,c=r.crossword.height,s=l.x,n=l.y;l.y+1<c&&r.crossword.cells[s][n+1].light===!0&&r.crossword.cells[s][n+1].cellElement.querySelector("input").focus();break;case 9:}}),r},n.prototype._updateDOM=function(){for(var e=this.currentClue,t=0;t<this.cells.length;t++)for(var s=0;s<this.cells[t].length;s++){var n=this.cells[t][s];n.light===!0&&(n.acrossClue===e||n.downClue===e?l(n.cellElement.querySelector("input"),"active"):r(n.cellElement.querySelector("input"),"active"))}},{buildCrossword:function(e){return o(e)}}}(window,document);
"use strict";function createCellElement(e){var l=document.createElement("div");if(l.className="cwcell",e.cellElement=l,!e.light)return l;l.className+=" light";var r=document.createElement("input");if(r.maxLength=1,l.appendChild(r),e.clueLabel){var t=document.createElement("div");t.className="cwcluelabel",t.innerHTML=e.clueLabel,l.appendChild(t)}return r.addEventListener("focus",function(e){var l=e.target.parentNode,r=getCellElementData(l),t=r.crosswordModel;t.currentX=r.cell.x,t.currentY=r.cell.y;for(var n=t.currentClue&&t.currentClue===r.cell.downClue?r.cell.downClue||r.cell.acrossClue:r.cell.acrossClue||r.cell.downClue,o=0;o<t.cells.length;o++)for(var s=0;s<t.cells[o].length;s++){var a=t.cells[o][s];a.light===!0&&(a.acrossClue===n||a.downClue===n?addClass(a.cellElement.querySelector("input"),"active"):removeClass(a.cellElement.querySelector("input"),"active"))}t.currentClue=n}),l.addEventListener("keydown",function(e){if(8===e.keyCode){e.preventDefault(),e.target.value="";var l=e.target.parentNode,r=getCellElementData(l),t=r.cell,n=r.crosswordModel.currentClue,o=t.acrossClue===n?t.acrossClueLetterIndex:t.downClueLetterIndex,s=o-1;s>=0&&n.cells[s].cellElement.querySelector("input").focus()}}),l.addEventListener("keypress",function(e){32===e.keyCode&&e.preventDefault(),e.target.value="";var l=e.target.parentNode,r=getCellElementData(l),t=r.cell,n=r.crosswordModel.currentClue,o=t.acrossClue===n?t.acrossClueLetterIndex:t.downClueLetterIndex,s=o+1;s<n.cells.length&&n.cells[s].cellElement.querySelector("input").focus()}),l.addEventListener("keyup",function(e){switch(e.keyCode){case 37:var l=e.target.parentNode,r=getCellElementData(l),t=r.cell,n=t.x,o=t.y;t.x>0&&r.crosswordModel.cells[n-1][o].light===!0&&r.crosswordModel.cells[n-1][o].cellElement.querySelector("input").focus();break;case 38:var l=e.target.parentNode,r=getCellElementData(l),t=r.cell,n=t.x,o=t.y;t.y>0&&r.crosswordModel.cells[n][o-1].light===!0&&r.crosswordModel.cells[n][o-1].cellElement.querySelector("input").focus();break;case 39:var l=e.target.parentNode,r=getCellElementData(l),t=r.cell,s=r.crosswordModel.width,n=t.x,o=t.y;t.x+1<s&&r.crosswordModel.cells[n+1][o].light===!0&&r.crosswordModel.cells[n+1][o].cellElement.querySelector("input").focus();break;case 40:var l=e.target.parentNode,r=getCellElementData(l),t=r.cell,a=r.crosswordModel.height,n=t.x,o=t.y;t.y+1<a&&r.crosswordModel.cells[n][o+1].light===!0&&r.crosswordModel.cells[n][o+1].cellElement.querySelector("input").focus();break;case 9:}}),l}function crossword(e){validateOptions(e);var l=buildCrosswordModel(e.crosswordDefinition);l.currentX=null,l.currentY=null,l.currentClue=null;var r=l.width,t=l.height,n=document.createElement("div");n.className="crossword";for(var o=0;t>o;o++){var s=document.createElement("div");s.className="cwrow",n.appendChild(s);for(var a=0;r>a;a++){var c=l.cells[a][o],u=createCellElement(c);s.appendChild(u),cellMap.push({cellElement:u,crosswordModel:l,cell:c})}}return e.element.appendChild(n),l}var cellMap=[],getCellElementData=function(e){for(var l=0;l<cellMap.length;l++)if(cellMap[l].cellElement===e)return cellMap[l];return null},getCellData=function(e){for(var l=0;l<cellMap.length;l++)if(cellMap[l].cell===e)return cellMap[l];return null},removeClass=function(e,l){var r=new RegExp("(?:^|\\s)"+l+"(?!\\S)","g");e.className=e.className.replace(r,"")},addClass=function(e,l){e.className+=" "+l},validateOptions=function(e){if(null===e||void 0===e)throw new Error("An options parameter must be passed to 'crossword'.");if(null===e.element||void 0===e.element)throw new Error("The crossword must be initialised with a valid DOM element.");if(null===e.crosswordDefinition||void 0===e.crosswordDefinition)throw new Error("The crossword must be initialised with a crossword definition.")},buildCrosswordModel=function(e){var l=e.width,r=e.height;if(void 0===l||null===l||0>l||void 0===r||null===r||0>r)throw new Error("The crossword bounds are invalid.");for(var t=[],n=0;l>n;n++){t[n]=[];for(var o=0;r>o;o++)t[n][o]={x:n,y:o,light:!1,clueLabel:null,acrossClue:null,acrossClueLetterIndex:null,downClue:null,downClueLetterIndex:null}}for(var s={width:l,height:r,cells:t,acrossClues:[],downClues:[]},a=e.acrossClues.concat(e.downClues),c=0;c<a.length;c++){var u=c<e.acrossClues.length,d=a[c],i={number:d.number,code:d.number+(u?"a":"d"),answer:d.answer,x:d.x-1,y:d.y-1,across:u,length:[],totalLength:0,clue:d.clue,cells:[]};if(i.x<0||i.x>=l||i.y<0||i.y>=r)throw new Error("Clue "+i.code+" doesn't start in the bounds.");for(var w=0;w<d.length.length;w++)i.length.push(d.length[w]),i.totalLength+=d.length[w];if(u){if(i.x+i.totalLength>l)throw new Error("Clue "+i.code+" exceeds horizontal bounds.")}else if(i.y+i.totalLength>r)throw new Error("Clue "+i.code+" exceeds vertical bounds.");for(var n=i.x,o=i.y,h=0;h<i.totalLength;h++){var C=t[n][o];if(C.light=!0,C[u?"acrossClue":"downClue"]=i,C[u?"acrossClueLetterIndex":"downClueLetterIndex"]=h,i.cells.push(C),i.answer){if(void 0!==C.answer&&C.answer!==i.answer[h])throw new Error("Clue "+i.code+" answer at ("+(n+1)+", "+(o+1)+") is not coherent with previous clue ("+C.acrossClue.code+") answer.");C.answer=i.answer[h]}if(0===h){if(null!==C.clueLabel&&C.clueLabel!==i.number)throw new Error("Clue "+i.code+" has a label which is inconsistent with another clue ("+C.acrossClue.code+").");C.clueLabel=i.number}u?n++:o++}}return s};
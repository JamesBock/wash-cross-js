var CrosswordsJS=function(e,t){"use strict";function r(e,t){var r=new RegExp("(?:^|\\s)"+t+"(?!\\S)","g");e.className=e.className.replace(r,"")}function l(e,t){e.className+=" "+t}function s(e,t){for(var r=new Array(e),l=0;t>l;l++){r[l]=new Array(t);for(var s=0;t>s;s++)r[l][s]={}}return r}function o(e){if(!e)throw new Error("The Crossword must be initialised with a crossword definition.");if(this.width=e.width,this.height=e.height,this.acrossClues=[],this.downClues=[],this.cells=s(this.width,this.height),void 0===this.width||null===this.width||this.width<0||void 0===this.height||null===this.height||this.height<0)throw new Error("The crossword bounds are invalid.");for(var t=e.acrossClues.concat(e.downClues),r=0;r<t.length;r++){var l=t[r],o=r<e.acrossClues.length,n={number:l.number,code:l.number+(o?"a":"d"),answer:l.answer,x:l.x-1,y:l.y-1,across:o,length:[],totalLength:0,clue:l.clue,cells:[]};if(this[o?"acrossClues":"downClues"].push(n),n.x<0||n.x>=this.width||n.y<0||n.y>=this.height)throw new Error("Clue "+n.code+" doesn't start in the bounds.");for(var c=0;c<l.length.length;c++)n.length.push(l.length[c]),n.totalLength+=l.length[c];if(o){if(n.x+n.totalLength>this.width)throw new Error("Clue "+n.code+" exceeds horizontal bounds.")}else if(n.y+n.totalLength>this.height)throw new Error("Clue "+n.code+" exceeds vertical bounds.");for(var a=n.x,u=n.y,i=0;i<n.totalLength;i++){var d=this.cells[a][u];if(d.light=!0,d[o?"acrossClue":"downClue"]=n,d[o?"acrossClueLetterIndex":"downClueLetterIndex"]=i,n.cells.push(d),n.answer){if(void 0!==d.answer&&d.answer!==n.answer[i])throw new Error("Clue "+n.code+" answer at ("+(a+1)+", "+(u+1)+") is not coherent with previous clue ("+d.acrossClue.code+") answer.");d.answer=n.answer[i]}if(0===i){if(d.clueLabel&&d.clueLabel!==n.number)throw new Error("Clue "+n.code+" has a label which is inconsistent with another clue ("+d.acrossClue.code+").");d.clueLabel=n.number}o?a++:u++}}}var n=[],c=function(e){for(var t=0;t<n.length;t++)if(n[t].cellElement===e)return n[t];return null};return o.prototype.createDOM=function(e){var r=t.createElement("div");r.className="crossword";for(var l=0;l<this.height;l++){var s=t.createElement("div");s.className="cwrow",r.appendChild(s);for(var o=0;o<this.width;o++){var c=this.cells[o][l],a=this._createCellDOM(c);s.appendChild(a),n.push({cellElement:a,crossword:this,cell:c})}}e.appendChild(r)},o.prototype.selectClue=function(e){this.currentClue=e,this._updateDOM(),this.currentClue.cells[0].cellElement.focus(),this._stateChange("clueSelected")},o.prototype.destroyDOM=function(){for(var e=0;e<n.length;e++){var t=n[e];t.crossword===this&&n.splice(e--,1)}this.parentElement.removeChild(this.crosswordElement),this.onStateChanged=null},o.prototype._stateChange=function(e,t){var r=this.onStateChanged;r&&r({message:e,data:t})},o.prototype._createCellDOM=function(e){var r=t.createElement("div");if(r.className="cwcell",e.cellElement=r,r.className+=e.light?" light":" dark",!e.light)return r;var l=t.createElement("input");if(l.maxLength=1,r.appendChild(l),e.clueLabel){var s=t.createElement("div");s.className="cwcluelabel",s.innerHTML=e.clueLabel,r.appendChild(s)}return l.addEventListener("focus",function(e){var t=e.target.parentNode,r=c(t),l=r.crossword,s=r.cell.acrossClue,o=r.cell.downClue;(!l.currentClue||l.currentClue!==s&&l.currentClue!==o)&&(l.currentClue=s&&!o||!s&&o?s||o:0===r.cell.downClueLetterIndex&&0!==r.cell.acrossClueLetterIndex?o:s,l._updateDOM(),l._stateChange("clueSelected"))}),r.addEventListener("keydown",function(e){if(8===e.keyCode){e.preventDefault(),e.target.value="";var t=e.target.parentNode,r=c(t),l=r.cell,s=r.crossword.currentClue,o=l.acrossClue===s?l.acrossClueLetterIndex:l.downClueLetterIndex,n=o-1;n>=0&&s.cells[n].cellElement.querySelector("input").focus()}else if(9===e.keyCode){e.preventDefault();for(var t=e.target.parentNode,r=c(t),s=r.crossword.currentClue,a=r.crossword,u=s.across?a.acrossClues:a.downClues,i=0;i<u.length;i++)if(s===u[i]){var d=null;d=e.shiftKey?i>0?u[i-1]:s.across?a.downClues[a.downClues.length-1]:a.acrossClues[a.acrossClues.length-1]:i<u.length-1?u[i+1]:s.across?a.downClues[0]:a.acrossClues[0],a.currentClue=d,a._updateDOM(),d.cells[0].cellElement.querySelector("input").focus({internal:!0});break}}else if(13===e.keyCode){e.preventDefault();var t=e.target.parentNode,r=c(t),l=r.cell,a=r.crossword;l.acrossClue&&l.downClue&&(a.currentClue=l.acrossClue===a.currentClue?l.downClue:l.acrossClue,a._updateDOM())}}),r.addEventListener("keypress",function(e){32===e.keyCode&&e.preventDefault(),e.target.value="";var t=e.target.parentNode,r=c(t),l=r.cell,s=r.crossword.currentClue,o=l.acrossClue===s?l.acrossClueLetterIndex:l.downClueLetterIndex,n=o+1;n<s.cells.length&&s.cells[n].cellElement.querySelector("input").focus()}),r.addEventListener("keyup",function(e){switch(e.keyCode){case 37:var t=e.target.parentNode,r=c(t),l=r.cell,s=l.x,o=l.y;l.x>0&&r.crossword.cells[s-1][o].light===!0&&r.crossword.cells[s-1][o].cellElement.querySelector("input").focus();break;case 38:var t=e.target.parentNode,r=c(t),l=r.cell,s=l.x,o=l.y;l.y>0&&r.crossword.cells[s][o-1].light===!0&&r.crossword.cells[s][o-1].cellElement.querySelector("input").focus();break;case 39:var t=e.target.parentNode,r=c(t),l=r.cell,n=r.crossword.width,s=l.x,o=l.y;l.x+1<n&&r.crossword.cells[s+1][o].light===!0&&r.crossword.cells[s+1][o].cellElement.querySelector("input").focus();break;case 40:var t=e.target.parentNode,r=c(t),l=r.cell,a=r.crossword.height,s=l.x,o=l.y;l.y+1<a&&r.crossword.cells[s][o+1].light===!0&&r.crossword.cells[s][o+1].cellElement.querySelector("input").focus();break;case 9:}}),r},o.prototype._updateDOM=function(){for(var e=this.currentClue,t=0;t<this.cells.length;t++)for(var s=0;s<this.cells[t].length;s++){var o=this.cells[t][s];o.light===!0&&(o.acrossClue===e||o.downClue===e?l(o.cellElement.querySelector("input"),"active"):r(o.cellElement.querySelector("input"),"active"))}},{Crossword:o,CrosswordDOM:CrosswordDOM}}(window,document);
//# sourceMappingURL=crosswords.min.js.map
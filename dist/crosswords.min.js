"use strict";function createCellElement(e){var l=document.createElement("div");if(l.className="cwcell",e.cellElement=l,!e.light)return l;l.className+=" light";var t=document.createElement("input");if(t.maxLength=1,l.appendChild(t),e.clueLabel){var r=document.createElement("div");r.className="cwcluelabel",r.innerHTML=e.clueLabel,l.appendChild(r)}return t.addEventListener("focus",function(e){var l=e.target.parentNode,t=getCellElementData(l),r=t.crosswordState;r.currentX=t.cell.x,r.currentY=t.cell.y;for(var a=0;a<r.cells.length;a++)for(var n=0;n<r.cells[a].length;n++){var s=r.cells[a][n];s.light===!0&&(s.clue===t.cell.clue?addClass(s.cellElement.querySelector("input"),"active"):removeClass(s.cellElement.querySelector("input"),"active"))}}),l.addEventListener("keyup",function(e){switch(e.keyCode){case 37:var l=e.target.parentNode,t=getCellElementData(l),r=t.cell,a=r.x,n=r.y;r.x>0&&t.crosswordState.cells[a-1][n].light===!0&&t.crosswordState.cells[a-1][n].cellElement.querySelector("input").focus();break;case 38:var l=e.target.parentNode,t=getCellElementData(l),r=t.cell,a=r.x,n=r.y;r.y>0&&t.crosswordState.cells[a][n-1].light===!0&&t.crosswordState.cells[a][n-1].cellElement.querySelector("input").focus();break;case 39:var l=e.target.parentNode,t=getCellElementData(l),r=t.cell,s=t.crosswordState.width,a=r.x,n=r.y;r.x+1<s&&t.crosswordState.cells[a+1][n].light===!0&&t.crosswordState.cells[a+1][n].cellElement.querySelector("input").focus();break;case 40:var l=e.target.parentNode,t=getCellElementData(l),r=t.cell,c=t.crosswordState.height,a=r.x,n=r.y;r.y+1<c&&t.crosswordState.cells[a][n+1].light===!0&&t.crosswordState.cells[a][n+1].cellElement.querySelector("input").focus()}}),l}function crossword(e){validateOptions(e);var l=buildCellModel(e.crossword),t={number:crosswordStates.length,width:e.crossword.width,height:e.crossword.height,cells:l,element:null,currentX:null,currentY:null},r=e.crossword.width,a=e.crossword.height,n=document.createElement("div");n.id="cw"+t.number,n.className="crossword";for(var s=0;a>s;s++){var c=document.createElement("div");c.className="cwrow",n.appendChild(c);for(var o=0;r>o;o++){var i=l[o][s],d=createCellElement(i);c.appendChild(d),cellElementDataMap.push({cellElement:d,crosswordState:t,cell:i})}}return e.element.appendChild(n),t.element=n,crosswordStates.push(t),t}var crosswordStates=[],cellElementDataMap=[],getCellElementData=function(e){for(var l=0;l<cellElementDataMap.length;l++)if(cellElementDataMap[l].cellElement===e)return cellElementDataMap[l];return null},getCellData=function(e){for(var l=0;l<cellElementDataMap.length;l++)if(cellElementDataMap[l].cell===e)return cellElementDataMap[l];return null},removeClass=function(e,l){var t=new RegExp("(?:^|\\s)"+l+"(?!\\S)");e.className=e.className.replace(t,"")},addClass=function(e,l){e.className+=" "+l},validateOptions=function(e){if(null===e||void 0===e)throw new Error("An options parameter must be passed to 'crossword'.");if(null===e.element||void 0===e.element)throw new Error("The crossword must be initialised with a valid DOM element.");if(null===e.crossword||void 0===e.crossword)throw new Error("The crossword must be initialised with a crossword.")},buildCellModel=function(e){var l=e.width,t=e.height;if(void 0===l||null===l||0>l||void 0===t||null===t||0>t)throw new Error("The crossword bounds are invalid.");for(var r=[],a=0;l>a;a++){r[a]=[];for(var n=0;t>n;n++)r[a][n]={x:a,y:n,light:!1,clue:null}}for(var s=0;s<e.clues.length;s++){var c=e.clues[s];c.cells=[];for(var o=0,i=0;i<c.length.length;i++)o+=c.length[i];if(c.x<1||c.x>l||c.y<1||c.y>t)throw new Error("Clue "+c.number+" doesn't start in the bounds.");if("across"===c.direction){if(c.x+o-1>l)throw new Error("Clue "+c.number+" exceeds horizontal bounds.")}else if(c.y+o-1>t)throw new Error("Clue "+c.number+" exceeds vertical bounds.");for(var a=c.x-1,n=c.y-1,d=0;o>d;d++){var u=r[a][n];if(u.light=!0,u.clue=c,c.cells.push(c),c.answer&&c.answer[d]){if(u.answer&&c.answer[d]!==u.answer)throw new Error("Clue "+c.number+" at ("+(a+1)+", "+(n+1)+") is not coherent with previous clues answers.");u.answer=c.answer[d]}0===d&&(u.clueLabel=c.number),"across"===c.direction?a++:n++}}return r};